# LLM-MLP

This project focuses on the predictive power of a (non-multimodel) LLM on Medical (Chest X-ray reports of patients) dataset to accurately classify a report as normal or not. This is part of a larger project which combines CNN and LLM to learn from images and the corresponding medical reports of the same patient to make highly accurate binary classification. In this project, only the MLP was trained. This project serves as a baseline for comparing CNN+LLM+MLP.

## Data

Indiana University Chest X-ray dataset was used in the project.
The dataset contains 7,470 pairs of images and reports and measures 14.19 GB. The reports were used as ground truth to compare CNN's predictions.
IU X-ray (Demner-Fushman et al., 2016) can be accessed [here](https://www.kaggle.com/datasets/raddar/chest-xrays-indiana-university)

## LLM

BioBert is used in this project. It's a pretrained (on medical reports) model therefore it comprehends medical jargons better than other textual LLM like Bert/GPT3 etc. All layers of the transformers remained frozen during the training.

## Multi-Layer Perceptron

Transfer Learning is used to avoid overfitting by freezing the LLM. The model uses pre-trained Conv Layers as a fixed feature extractor. Only the MLP, which acts as the binary classification layer is trained in all the 40 epochs.

## Parameters

| Parameters | Specification |
| --- | --- |
| Optimizer | AdamW |
| Loss Function | Cross Entropy |
| Trainable Parameters | 202,242 |
| Batch Normalization | True |
| Text Augmentation | False |
| Droput in 2nd Layer MLP | 0.5 |
| Learning Rate | 0.001 |
| Adaptive Learning Rate | Linear LR Decay from 1.0 to 0.1 |
| Number of Epochs | 40 |
| Train / Test data | 80/20 |

## Results

| Epoch | Phase | Loss   | Accuracy | Precision | Recall | F1     | Sensitivity | ROC AUC | PR AUC |
|-------|-------|--------|----------|-----------|--------|--------|-------------|---------|--------|
| 1     | Train | 0.5011 | 0.7735   | 0.8475    | 0.7942 | 0.8200 | 0.7942      | 0.8442  | 0.9042 |
|       | Val   | 1.0520 | 0.5405   | 0.9784    | 0.2804 | 0.4359 | 0.2804      | 0.9320  | 0.9531 |
| 2     | Train | 0.4734 | 0.7997   | 0.8670    | 0.8168 | 0.8412 | 0.8168      | 0.8735  | 0.9238 |
|       | Val   | 0.3081 | 0.8525   | 0.9769    | 0.7856 | 0.8709 | 0.7856      | 0.9537  | 0.9718 |
| 3     | Train | 0.4458 | 0.8141   | 0.8751    | 0.8324 | 0.8532 | 0.8324      | 0.8863  | 0.9309 |
|       | Val   | 0.2798 | 0.8812   | 0.9646    | 0.8433 | 0.8999 | 0.8433      | 0.9588  | 0.9722 |
| 4     | Train | 0.4478 | 0.8160   | 0.8708    | 0.8415 | 0.8559 | 0.8415      | 0.8883  | 0.9338 |
|       | Val   | 0.3307 | 0.8264   | 0.9681    | 0.7505 | 0.8455 | 0.7505      | 0.9602  | 0.9712 |
| 5     | Train | 0.4016 | 0.8363   | 0.8931    | 0.8495 | 0.8708 | 0.8495      | 0.9090  | 0.9487 |
|       | Val   | 0.6404 | 0.7063   | 0.9815    | 0.5464 | 0.7020 | 0.5464      | 0.9588  | 0.9693 |
| 6     | Train | 0.4198 | 0.8324   | 0.8827    | 0.8556 | 0.8689 | 0.8556      | 0.9062  | 0.9459 |
|       | Val   | 0.3096 | 0.9125   | 0.9114    | 0.9546 | 0.9325 | 0.9546      | 0.9591  | 0.9707 |
| 7     | Train | 0.4315 | 0.8376   | 0.8836    | 0.8636 | 0.8735 | 0.8636      | 0.9032  | 0.9448 |
|       | Val   | 0.2518 | 0.9008   | 0.9616    | 0.8784 | 0.9181 | 0.8784      | 0.9642  | 0.9767 |
| 8     | Train | 0.4319 | 0.8340   | 0.8862    | 0.8541 | 0.8698 | 0.8541      | 0.9010  | 0.9437 |
|       | Val   | 0.2483 | 0.9047   | 0.9558    | 0.8907 | 0.9221 | 0.8907      | 0.9650  | 0.9774 |
| 9     | Train | 0.4124 | 0.8373   | 0.8844    | 0.8621 | 0.8731 | 0.8621      | 0.9087  | 0.9492 |
|       | Val   | 0.3127 | 0.8329   | 0.9760    | 0.7546 | 0.8512 | 0.7546      | 0.9653  | 0.9775 |
| 10    | Train | 0.4184 | 0.8350   | 0.8904    | 0.8505 | 0.8700 | 0.8505      | 0.9069  | 0.9470 |
|       | Val   | 0.3089 | 0.8473   | 0.9742    | 0.7794 | 0.8660 | 0.7794      | 0.9629  | 0.9734 |
| 11    | Train | 0.4181 | 0.8330   | 0.8864    | 0.8520 | 0.8689 | 0.8520      | 0.9083  | 0.9477 |
|       | Val   | 0.3236 | 0.8433   | 0.9716    | 0.7753 | 0.8624 | 0.7753      | 0.9615  | 0.9757 |
| 12    | Train | 0.3911 | 0.8507   | 0.9009    | 0.8651 | 0.8827 | 0.8651      | 0.9189  | 0.9540 |
|       | Val   | 0.2812 | 0.8734   | 0.9686    | 0.8268 | 0.8921 | 0.8268      | 0.9651  | 0.9767 |
| 13    | Train | 0.3950 | 0.8490   | 0.8924    | 0.8727 | 0.8824 | 0.8727      | 0.9185  | 0.9544 |
|       | Val   | 0.2917 | 0.8512   | 0.9720    | 0.7876 | 0.8702 | 0.7876      | 0.9688  | 0.9805 |
| 14    | Train | 0.4050 | 0.8444   | 0.8925    | 0.8646 | 0.8783 | 0.8646      | 0.9169  | 0.9512 |
|       | Val   | 0.3792 | 0.8355   | 0.9736    | 0.7608 | 0.8542 | 0.7608      | 0.9644  | 0.9727 |
| 15    | Train | 0.4100 | 0.8317   | 0.8861    | 0.8500 | 0.8677 | 0.8500      | 0.9122  | 0.9528 |
|       | Val   | 0.2412 | 0.9008   | 0.9637    | 0.8763 | 0.9179 | 0.8763      | 0.9691  | 0.9806 |
| 16    | Train | 0.3965 | 0.8382   | 0.8885    | 0.8586 | 0.8733 | 0.8586      | 0.9152  | 0.9534 |
|       | Val   | 0.2338 | 0.9151   | 0.9506    | 0.9134 | 0.9317 | 0.9134      | 0.9683  | 0.9801 |
| 17    | Train | 0.3863 | 0.8516   | 0.8929    | 0.8767 | 0.8847 | 0.8767      | 0.9216  | 0.9560 |
|       | Val   | 0.3393 | 0.8512   | 0.9696    | 0.7897 | 0.8705 | 0.7897      | 0.9629  | 0.9759 |
| 18    | Train | 0.3612 | 0.8592   | 0.9061    | 0.8737 | 0.8896 | 0.8737      | 0.9297  | 0.9618 |
|       | Val   | 0.2384 | 0.9321   | 0.9577    | 0.9340 | 0.9457 | 0.9340      | 0.9658  | 0.9781 |
| 19    | Train | 0.3734 | 0.8523   | 0.8975    | 0.8722 | 0.8846 | 0.8722      | 0.9280  | 0.9602 |
|       | Val   | 0.3151 | 0.8433   | 0.9740    | 0.7732 | 0.8621 | 0.7732      | 0.9665  | 0.9785 |
| 20    | Train | 0.3978 | 0.8500   | 0.8938    | 0.8727 | 0.8831 | 0.8727      | 0.9219  | 0.9557 |
|       | Val   | 0.2867 | 0.8668   | 0.9682    | 0.8165 | 0.8859 | 0.8165      | 0.9680  | 0.9799 |
| 21    | Train | 0.3585 | 0.8592   | 0.9027    | 0.8777 | 0.8900 | 0.8777      | 0.9333  | 0.9643 |
|       | Val   | 0.2709 | 0.8760   | 0.9710    | 0.8289 | 0.8943 | 0.8289      | 0.9704  | 0.9806 |
| 22    | Train | 0.3715 | 0.8631   | 0.9037    | 0.8832 | 0.8934 | 0.8832      | 0.9296  | 0.9620 |
|       | Val   | 0.3832 | 0.8238   | 0.9755    | 0.7402 | 0.8417 | 0.7402      | 0.9660  | 0.9785 |
| 23    | Train | 0.4405 | 0.8402   | 0.8849    | 0.8666 | 0.8757 | 0.8666      | 0.9106  | 0.9470 |
|       | Val   | 0.2521 | 0.9151   | 0.9565    | 0.9072 | 0.9312 | 0.9072      | 0.9655  | 0.9726 |
| 24    | Train | 0.3729 | 0.8663   | 0.9114    | 0.8797 | 0.8953 | 0.8797      | 0.9288  | 0.9581 |
|       | Val   | 0.3117 | 0.8551   | 0.9770    | 0.7897 | 0.8734 | 0.7897      | 0.9709  | 0.9815 |
| 25    | Train | 0.3952 | 0.8582   | 0.8996    | 0.8797 | 0.8896 | 0.8797      | 0.9244  | 0.9564 |
|       | Val   | 0.2586 | 0.8864   | 0.9650    | 0.8515 | 0.9047 | 0.8515      | 0.9707  | 0.9813 |
| 26    | Train | 0.3737 | 0.8592   | 0.8978    | 0.8837 | 0.8907 | 0.8837      | 0.9309  | 0.9623 |
|       | Val   | 0.2358 | 0.9230   | 0.9551    | 0.9216 | 0.9381 | 0.9216      | 0.9707  | 0.9813 |
| 27    | Train | 0.3641 | 0.8621   | 0.9011    | 0.8848 | 0.8928 | 0.8848      | 0.9321  | 0.9632 |
|       | Val   | 0.2686 | 0.8773   | 0.9644    | 0.8371 | 0.8962 | 0.8371      | 0.9705  | 0.9808 |
| 28    | Train | 0.3800 | 0.8683   | 0.9082    | 0.8868 | 0.8974 | 0.8868      | 0.9307  | 0.9622 |
|       | Val   | 0.3075 | 0.8486   | 0.9767    | 0.7794 | 0.8670 | 0.7794      | 0.9717  | 0.9824 |
| 29    | Train | 0.3774 | 0.8618   | 0.9099    | 0.8737 | 0.8914 | 0.8737      | 0.9302  | 0.9607 |
|       | Val   | 0.3095 | 0.8460   | 0.9693    | 0.7814 | 0.8653 | 0.7814      | 0.9715  | 0.9815 |
| 30    | Train | 0.3714 | 0.8601   | 0.9012    | 0.8812 | 0.8911 | 0.8812      | 0.9318  | 0.9622 |
|       | Val   | 0.2589 | 0.8877   | 0.9672    | 0.8515 | 0.9057 | 0.8515      | 0.9708  | 0.9817 |
| 31    | Train | 0.3835 | 0.8598   | 0.8995    | 0.8827 | 0.8910 | 0.8827      | 0.9298  | 0.9587 |
|       | Val   | 0.2626 | 0.8773   | 0.9688    | 0.8330 | 0.8958 | 0.8330      | 0.9708  | 0.9820 |
| 32    | Train | 0.3645 | 0.8673   | 0.9137    | 0.8787 | 0.8958 | 0.8787      | 0.9340  | 0.9633 |
|       | Val   | 0.2238 | 0.9060   | 0.9640    | 0.8845 | 0.9226 | 0.8845      | 0.9731  | 0.9835 |
| 33    | Train | 0.3823 | 0.8667   | 0.9051    | 0.8878 | 0.8963 | 0.8878      | 0.9306  | 0.9603 |
|       | Val   | 0.2262 | 0.9047   | 0.9558    | 0.8907 | 0.9221 | 0.8907      | 0.9725  | 0.9829 |
| 34    | Train | 0.3754 | 0.8634   | 0.9005    | 0.8878 | 0.8941 | 0.8878      | 0.9318  | 0.9604 |
|       | Val   | 0.2227 | 0.9178   | 0.9607    | 0.9072 | 0.9332 | 0.9072      | 0.9732  | 0.9835 |
| 35    | Train | 0.3802 | 0.8605   | 0.8988    | 0.8848 | 0.8917 | 0.8848      | 0.9321  | 0.9626 |
|       | Val   | 0.2805 | 0.8668   | 0.9728    | 0.8124 | 0.8854 | 0.8124      | 0.9715  | 0.9820 |
| 36    | Train | 0.3467 | 0.8729   | 0.9166    | 0.8848 | 0.9004 | 0.8848      | 0.9409  | 0.9664 |
|       | Val   | 0.2245 | 0.9191   | 0.9608    | 0.9093 | 0.9343 | 0.9093      | 0.9721  | 0.9830 |
| 37    | Train | 0.3547 | 0.8748   | 0.9113    | 0.8943 | 0.9027 | 0.8943      | 0.9381  | 0.9642 |
|       | Val   | 0.2360 | 0.9086   | 0.9621    | 0.8907 | 0.9251 | 0.8907      | 0.9717  | 0.9827 |
| 38    | Train | 0.3749 | 0.8654   | 0.9091    | 0.8807 | 0.8947 | 0.8807      | 0.9332  | 0.9627 |
|       | Val   | 0.3758 | 0.8316   | 0.9759    | 0.7526 | 0.8498 | 0.7526      | 0.9713  | 0.9822 |
| 39    | Train | 0.3604 | 0.8703   | 0.9027    | 0.8968 | 0.8998 | 0.8968      | 0.9367  | 0.9641 |
|       | Val   | 0.2657 | 0.8864   | 0.9716    | 0.8454 | 0.9041 | 0.8454      | 0.9720  | 0.9824 |
| 40    | Train | 0.3664 | 0.8703   | 0.9064    | 0.8923 | 0.8993 | 0.8923      | 0.9361  | 0.9635 |
|       | Val   | 0.2646 | 0.8903   | 0.9696    | 0.8536 | 0.9079 | 0.8536      | 0.9729  | 0.9828 |

## Conclusion


